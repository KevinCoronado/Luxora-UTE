<!DOCTYPE html>
<html lang="es">
<head>
    
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="estilos.css">

    <title>Productos Admin</title>
</head>
<body>
    
    <div class="navbar">
        <a href="inicio.html" class="logo-link">
            <img src="imagenes/luxora_logo.png" alt="logo" class="logo">
        </a>
        <div class="nav-links">
            <a href="#">Usuarios</a>
            <a href="#">Compras</a>
            <a href="#">Artículos</a>
            <a href="#">Mi perfil</a>
        </div>
    </div>
   
    <div class="containerRegistroAdmin">
        <h2>Agregar Producto</h2>
        <form id="agregarUsuarioForm" action="php/agregar_productos.php" method="post" enctype="multipart/form-data">
            <div class="form-row">
                <div class="form-group">
                    <label for="nombre">Nombre del articulo</label>
                    <input type="text" id="nombre" name="nombre" required>
                </div>
                <div class="form-group">
                    <label for="descripcion">Descripcion</label>
                    <input type="text" id="descripcion" name="descripcion" required>
                </div>
                <div class="form-group">
                    <label for="marca">Marca</label>
                    <input type="text" id="marca" name="marca" required>
                </div>
                <div class="form-group">
                    <label for="imagen">Imagen</label>
                    <input type="file" id="imagen" name="imagen" required>
                </div>
                <div class="form-group">
                    <label for="disponibilidad">Disponibilidad</label>
                    <input type="text" id="disponibilidad" name="disponibilidad" required>
                </div>
                <div class="form-group">
                    <label for="precio">Precio</label>
                    <input type="text" id="precio" name="precio" required>
                </div>
            </div>
            <button type="submit" class="entregar-btn">Agregar Producto</button>
        </form>
    </div>


    <div class="containerUsuarios">
        <h2>Lista de Productos</h2>
        <div class="search-container">
            <input type="text" id="searchInput" placeholder="Buscar por nombre o marca...">
        </div>
        <table>
            <thead>
                <tr>
                    <th>Id</th>
                    <th>Nombre</th>
                    <th>Descripcion</th>
                    <th>Marca</th>
                    <th>Imagen</th>
                    <th>Precio MXN</th>
                    <th>Disponibilidad</th>
                    <th>Acciones</th>
                </tr>
                <tbody id="articulosTableBody">
  
                </tbody>
            </thead>
        </table>

        <div id="pagination" class="pagination">
            <!-- Paginación será añadida aquí dinámicamente -->
        </div>
    </div>


    <script>

        
        document.getElementById('agregarUsuarioForm').addEventListener('submit', function(event) {
            event.preventDefault();
            const formData = new FormData(this);
            
            fetch('php/agregar_productos.php', {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert(data.message);
                    this.reset(); 
                    fetchArticulos(); 
                } else {
                    alert(data.message);
                }
            })
            .catch(error => {
                console.error('Error:', error);
            });
        });

        const articulosPorPagina = 10;
            let paginaActual = 1;
            let articulos = [];
            let articulosFiltrados = [];


        function mostrarArticulos(pagina) {
            const tablaCuerpo = document.getElementById('articulosTableBody');
            tablaCuerpo.innerHTML = '';
    
            const inicio = (pagina - 1) * articulosPorPagina;
            const fin = inicio + articulosPorPagina;
            const articulosPagina = articulosFiltrados.slice(inicio, fin);
    
            articulosPagina.forEach(articulo => {
                const fila = document.createElement('tr');
                fila.innerHTML = `
                    <td>${articulo.Id_articulo}</td>
                    <td>${articulo.Nombre_articulo}</td>
                    <td>${articulo.Descripcion}</td>
                    <td>${articulo.Marca}</td>
                    <td><img src="${articulo.Imagen}" alt="${articulo.Nombre_articulo}" width="50"></td>
                    <td>${articulo.Precio}</td>
                    <td>${articulo.Disponibilidad}</td>
                    <td>
                        <button class="editar-btn" onclick="editarArticulo(this)">Editar</button>
                        <button class="eliminar-btn" onclick="eliminarArticulo(this)">Eliminar</button>
                    </td>
                `;
                tablaCuerpo.appendChild(fila);
            });
    
            actualizarPaginacion();
        }


        function fetchArticulos() {
            fetch('php/ver_productos.php')
                .then(response => response.json())
                .then(data => {
                    articulos = data;
                    articulosFiltrados = articulos;
                    mostrarArticulos(paginaActual);
                })
                .catch(error => console.error('Error al obtener los articulos:', error));
        }

            function actualizarPaginacion() {
                const paginacion = document.getElementById('pagination');
                paginacion.innerHTML = '';
        
                const numPaginas = Math.ceil(articulosFiltrados.length / articulosPorPagina);
        
                for (let i = 1; i <= numPaginas; i++) {
                    const boton = document.createElement('button');
                    boton.textContent = i;
                    boton.className = i === paginaActual ? 'active' : '';
                    boton.addEventListener('click', function() {
                        paginaActual = i;
                        mostrarArticulos(paginaActual);
                    });
                    paginacion.appendChild(boton);
                }
            }
        
            function filtrarArticulos() {
                const query = document.getElementById('searchInput').value.toLowerCase();
                articulosFiltrados = articulos.filter(articulo => 
                    articulo.Nombre_articulo.toLowerCase().includes(query) || 
                    articulo.Marca.toLowerCase().includes(query)
                );
                paginaActual = 1; // Reiniciar a la primera página
                mostrarArticulos(paginaActual);
            }
        
            // Manejar la entrada de búsqueda
            document.getElementById('searchInput').addEventListener('input', filtrarArticulos);
        
            fetchArticulos();
     
        
        

    </script>
</body>
</html>